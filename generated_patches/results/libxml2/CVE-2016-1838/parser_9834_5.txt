@@ -9821,6 +9821,7 @@
  * [NS 9] ETag ::= '</' QName S? '>'
  */
 
+
 static void
 xmlParseEndTag2(xmlParserCtxtPtr ctxt, const xmlChar *prefix,
                 const xmlChar *URI, int line, int nsNr, int tlen) {
@@ -9833,6 +9834,11 @@
     }
     SKIP(2);
 
+    if (ctxt->input->cur == NULL || ctxt->input->cur + tlen > ctxt->input->end) {
+        xmlFatalErr(ctxt, XML_ERR_INVALID_CHAR, NULL);
+        return;
+    }
+
     if ((tlen > 0) && (xmlStrncmp(ctxt->input->cur, ctxt->name, tlen) == 0)) {
         if (ctxt->input->cur[tlen] == '>') {
 	    ctxt->input->cur += tlen + 1;
@@ -9890,6 +9896,7 @@
     return;
 }
 
+
 /**
  * xmlParseCDSect:
  * @ctxt:  an XML parser context
