@@ -1146,11 +1146,12 @@
  * before any strips or tiles of a different plane are stored.
  */
 
+
 static int 
 writeBufferToSeparateStrips (TIFF* out, uint8* buf, 
 			     uint32 length, uint32 width, uint16 spp,
 			     struct dump_opts *dump)
-  {
+{
   uint8   *src;
   uint16   bps;
   uint32   row, nrows, rowsize, rowsperstrip;
@@ -1167,7 +1168,7 @@
   bytes_per_sample = (bps + 7) / 8;
   rowsize = ((bps * spp * width) + 7) / 8; /* source has interleaved samples */
   
-  if (rowsperstrip == 0 || width == 0) {
+  if (rowsperstrip == 0 || width == 0 || (rowsperstrip * bytes_per_sample) > (UINT_MAX / width)) {
       _TIFFfree(obuf);
       return 1; // Handle invalid inputs
   }
@@ -1215,6 +1216,7 @@
 }
 
 
+
 /* Extract all planes from contiguous buffer into a single tile buffer 
  * to be written out as a tile.
  */
