@@ -800,6 +800,7 @@
 }
 
 
+
 static int
 OJPEGDecodeRaw(TIFF* tif, uint8* buf, tmsize_t cc)
 {
@@ -814,7 +815,7 @@
 	uint32 q;
 	uint8* r;
 	uint8 sx,sy;
-	if (cc <= 0 || cc % sp->bytes_per_line != 0)
+	if (cc <= 0 || sp->bytes_per_line <= 0 || cc % sp->bytes_per_line != 0)
 	{
 		TIFFErrorExt(tif->tif_clientdata,module,"Invalid scanline size");
 		return(0);
@@ -856,6 +857,7 @@
 }
 
 
+
 static int
 OJPEGDecodeScanlines(TIFF* tif, uint8* buf, tmsize_t cc)
 {
