@@ -298,6 +298,7 @@
 }
 
 
+
 LOCAL(boolean)
 get_sos (j_decompress_ptr cinfo)
 /* Process a SOS marker */
@@ -322,25 +323,24 @@
   cinfo->comps_in_scan = n;
 
   /* Collect the component-spec parameters */
-
-  for (i = 0; i < cinfo->num_components; i++)
-    cinfo->cur_comp_info[i] = NULL;
-
+  
   for (i = 0; i < n; i++) {
     INPUT_BYTE(cinfo, cc, return FALSE);
     INPUT_BYTE(cinfo, c, return FALSE);
     
     for (ci = 0, compptr = cinfo->comp_info; ci < cinfo->num_components;
 	 ci++, compptr++) {
-      if (cc == compptr->component_id && !cinfo->cur_comp_info[ci])
-	goto id_found;
+      if (cc == compptr->component_id) {
+        if (!cinfo->cur_comp_info[ci]) {
+	  cinfo->cur_comp_info[i] = compptr; // Only set it if the pointer is null.
+          break; // Exit from the inner loop if found.
+        }
+      }
     }
 
-    ERREXIT1(cinfo, JERR_BAD_COMPONENT_ID, cc);
+    if (ci == cinfo->num_components) // Component not found
+      ERREXIT1(cinfo, JERR_BAD_COMPONENT_ID, cc);
 
-  id_found:
-
-    cinfo->cur_comp_info[i] = compptr;
     compptr->dc_tbl_no = (c >> 4) & 15;
     compptr->ac_tbl_no = (c     ) & 15;
     
@@ -371,6 +371,7 @@
 }
 
 
+
 #ifdef D_ARITH_CODING_SUPPORTED
 
 LOCAL(boolean)
