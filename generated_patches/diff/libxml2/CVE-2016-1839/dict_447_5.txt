@@ -440,11 +440,12 @@
  * Calculate a hash key using a fast hash function that works well
  * for low hash table fill.
  */
+
 static unsigned long
 xmlDictComputeFastKey(const xmlChar *name, int namelen, int seed) {
     unsigned long value = seed;
 
-    if (name == NULL) return(0);
+    if (name == NULL || namelen < 0) return(0);
     value = *name;
     value <<= 5;
     if (namelen > 10) {
@@ -452,20 +453,21 @@
         namelen = 10;
     }
     switch (namelen) {
-        case 10: value += name[9];
-        case 9: value += name[8];
-        case 8: value += name[7];
-        case 7: value += name[6];
-        case 6: value += name[5];
-        case 5: value += name[4];
-        case 4: value += name[3];
-        case 3: value += name[2];
-        case 2: value += name[1];
+        case 10: value += name[9]; // fall through
+        case 9: value += name[8];  // fall through
+        case 8: value += name[7];  // fall through
+        case 7: value += name[6];  // fall through
+        case 6: value += name[5];  // fall through
+        case 5: value += name[4];  // fall through
+        case 4: value += name[3];  // fall through
+        case 3: value += name[2];  // fall through
+        case 2: value += name[1];  // fall through
         default: break;
     }
     return(value);
 }
 
+
 /*
  * xmlDictComputeFastQKey:
  *
