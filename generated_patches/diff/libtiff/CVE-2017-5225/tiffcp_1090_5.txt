@@ -1057,6 +1057,7 @@
 /*
  * Contig -> separate by row.
  */
+
 DECLAREcpFunc(cpContig2SeparateByRow)
 {
 	tsize_t scanlinesizein = TIFFScanlineSize(in);
@@ -1087,6 +1088,12 @@
 			inp = ((uint8*)inbuf) + s;
 			outp = (uint8*)outbuf;
 			for (n = imagewidth; n-- > 0;) {
+				if (inp >= (uint8*)inbuf + scanlinesizein) {
+					TIFFError(TIFFFileName(in),
+					    "Input buffer overflow at row %lu, channel %u",
+					    (unsigned long) row, s);
+					goto bad;
+				}
 				*outp++ = *inp;
 				inp += spp;
 			}
@@ -1107,6 +1114,7 @@
 	return 0;
 }
 
+
 /*
  * Separate -> contig by row.
  */
